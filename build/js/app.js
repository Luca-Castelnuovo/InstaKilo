"use strict";function materialize_init(){M.Sidenav.init(document.querySelectorAll(".sidenav"),{edge:"right",draggable:1});M.CharacterCounter.init(document.querySelectorAll(".counter"));M.Materialbox.init(document.querySelectorAll(".materialboxed"),{}),M.Tooltip.init(document.querySelectorAll(".tooltipped"),{}),M.Modal.init(document.querySelectorAll(".modal"),{})}function GETrequest(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){var e=JSON.parse(n.responseText);CSRFtoken=e.CSRFtoken,t(e)}},n.open("GET",e),n.send()}function FORMrequest(e,t,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.responseText);CSRFtoken=e.CSRFtoken,n(e)}},o.open("POST",e,!0),o.send(t)}function feed_render_posts(e,t){var n=arguments.length>1&&void 0!==t&&t;if(n||setInterval(feed_check_posts,6e4),!e.success)return!n&&'\n        <div class="col s12">\n            <div class="card">\n                <div class="card-content">\n                    <h4>You don\'t have any posts.</h4>\n                </div>\n                <div class="card-action center">\n                    <div class="row mb-0">\n                        <a href="/posts/add" class="btn waves-effect waves-light blue accent-4 col s12">Create a post</a>\n                    </div>\n                </div>\n            </div>\n        </div>\n        ';n||(delete e.CSRFtoken,localStorage.setItem("posts",JSON.stringify(e)));var o=[],s=!0,a=!1,r=void 0;try{for(var l,i=e.posts[Symbol.iterator]();!(s=(l=i.next()).done);s=!0)post=l.value,o.push(feed_render_post(post))}catch(e){a=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(a)throw r}}return o.join("")}function feed_render_posts_profile(e){if(!e.success)return'\n        <div class="col s12">\n            <div class="card">\n                <div class="card-content">\n                    <h4>This user doesn\'t have any posts.</h4>\n                </div>\n            </div>\n        </div>\n        ';var t=[],n=!0,o=!1,s=void 0;try{for(var a,r=e.posts[Symbol.iterator]();!(n=(a=r.next()).done);n=!0)post=a.value,t.push(feed_render_post(post,!0))}catch(e){o=!0,s=e}finally{try{n||null==r.return||r.return()}finally{if(o)throw s}}return t.join("")}function feed_check_posts(){GETrequest("https://instakilo.lucacastelnuovo.nl/posts/actions/feed",function(e){delete e.CSRFtoken,JSON.stringify(e)!==localStorage.getItem("posts")&&(M.Toast.dismissAll(),M.toast({html:'<span>You have new posts!</span><button class="btn-flat toast-action blue-text accent-4" onclick="location.reload()">Load Posts</button>'}))})}function feed_like_post(e){GETrequest("https://instakilo.lucacastelnuovo.nl/posts/actions/like/".concat(CSRFtoken,"/").concat(e),function(t){if(t.success){document.querySelector("#post-".concat(e," .post_likes")).innerHTML=t.likes+" likes",document.querySelector("#post-".concat(e," a")).setAttribute("onClick","feed_undo_like_post(".concat(e,")")),document.querySelector("#post-".concat(e," a i")).innerHTML="favorite",M.Toast.dismissAll(),M.toast({html:"Liked"});var n=JSON.parse(localStorage.getItem("posts")),o=n.posts.map(function(t){return t.id==e&&(t.liked=!0,t.likes++,t.likes="".concat(t.likes)),t});n.posts=o,localStorage.setItem("posts",JSON.stringify(n))}})}function feed_undo_like_post(e){GETrequest("https://instakilo.lucacastelnuovo.nl/posts/actions/undo_like/".concat(CSRFtoken,"/").concat(e),function(t){if(t.success){document.querySelector("#post-".concat(e," .post_likes")).innerHTML=t.likes+" likes",document.querySelector("#post-".concat(e," a")).setAttribute("onClick","feed_like_post(".concat(e,")")),document.querySelector("#post-".concat(e," a i")).innerHTML="favorite_border",M.Toast.dismissAll(),M.toast({html:"Like removed"});var n=JSON.parse(localStorage.getItem("posts")),o=n.posts.map(function(t){return t.id==e&&(t.liked=!1,t.likes--,t.likes="".concat(t.likes)),t});n.posts=o,localStorage.setItem("posts",JSON.stringify(n))}})}function feed_comment_post(e){var t=new FormData(e);if(t.get("comment").length>200)return M.Toast.dismissAll(),M.toast({html:"Comment too long"}),!1;if(t.get("comment").length<1)return M.Toast.dismissAll(),M.toast({html:"Comment too short"}),!1;t.append("CSRFtoken",CSRFtoken);var n=t.get("post_id");FORMrequest("/posts/actions/",t,function(e){if(e.success){document.querySelector("#form_comment-".concat(n)).value="";var t=document.createElement("div");t.innerHTML=feed_render_comment(e.new_comment,n),document.querySelector("#comment-container-".concat(n)).appendChild(t),M.Toast.dismissAll(),M.toast({html:"Comment sent"});var o=JSON.parse(localStorage.getItem("posts")),s=o.posts.map(function(t){return t.id==n&&(t.comments=e.comments),t});o.posts=s,localStorage.setItem("posts",JSON.stringify(o)),render_hashtags()}})}function feed_delete_comment(e,t){if(!confirm("Are you sure?"))return!1;GETrequest("https://instakilo.lucacastelnuovo.nl/posts/actions/delete_comment/".concat(CSRFtoken,"/").concat(e,"&comment_id=").concat(t),function(n){if(n.success){var o=document.querySelector("#comment-".concat(e,"-").concat(t));o.parentNode.removeChild(o),M.Toast.dismissAll(),M.toast({html:"Comment deleted"});var s=JSON.parse(localStorage.getItem("posts")),a=s.posts.map(function(n){return n.id==e&&(n.comments=n.comments.filter(function(e){return e.id!==t})),n});s.posts=a,localStorage.setItem("posts",JSON.stringify(s))}})}function feed_render_post(e,t){var n,o,s=arguments.length>1&&void 0!==t&&t;e.comments_allowed?(n=feed_render_comments(e.comments,s,e.id),o='\n            <form action="/posts/actions" method="POST" onsubmit="event.preventDefault(); feed_comment_post(this);">\n                <div class="row mb-0">\n                    <div class="col s10">\n                        <div class="input-field">\n                            <label for="form_comment-'.concat(e.id,'">Comment</label>\n                            <textarea id="form_comment-').concat(e.id,'" class="materialize-textarea counter" name="comment" data-length="200"></textarea>\n                        </div>\n                    </div>\n                    <div class="input-field col s2">\n                        <input type="hidden" name="post_id" value="').concat(e.id,'">\n                        <button type="submit" class="btn-floating btn waves-effect waves-light blue accent-4">\n                            <i class="material-icons">send</i>\n                        </button>\n                    </div>\n                </div>\n            </form>\n        ')):(n='<li class="collection-item">Comments are disabled</li>',o="");var a=e.liked?"favorite":"favorite_border",r=e.liked?"feed_undo_like_post(".concat(e.id,")"):"feed_like_post(".concat(e.id,")");return'\n        <div class="col s12 '.concat(s?"m6 l4":"",'">\n            <div class="card mt-0">\n                <div class="card-image"><img id="post_image" class="materialboxed lazy" data-caption="').concat(e.caption,'" data-src="').concat(e.img_url,'" src="https://via.placeholder.com/150.jpg"></div>\n                <div class="card-content">\n                    <p>\n                        <span class="bold"><a href="/u/').concat(e.username,'">').concat(e.username,'</a></span> <span class="post_caption">').concat(e.caption,"</span>\n                        ").concat(e.user_is_owner?'<a href="/posts/edit/'.concat(e.id,'" class="secondary-content tooltipped" data-position="right" data-tooltip="Edit post"><i class="material-icons blue-icon">edit</i></a>'):"",'\n                    </p>\n                </div>\n                <div class="card-action">\n                    <div class="row likes" id="post-').concat(e.id,'">\n                        <a onclick="').concat(r,'" class="mr-6"><i class="material-icons blue-icon">').concat(a,'</i></a> <span class="post_likes">').concat(e.likes," likes</span>\n                    </div>\n                    ").concat(s?"":'<div class="row mb-0">\n                        <h6>Comments:</h6>\n                        <ul id="comment-container-'.concat(e.id,'" class="collection">\n                            ').concat(n,"\n                        </ul>\n                            ").concat(o,"\n                    </div>"),"\n                </div>\n            </div>\n        </div>\n    ")}function feed_render_comments(e,t,n){var o=[];t&&(e=e.slice(0,3));var s=!0,a=!1,r=void 0;try{for(var l,i=e[Symbol.iterator]();!(s=(l=i.next()).done);s=!0)comment=l.value,o.push(feed_render_comment(comment,n))}catch(e){a=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(a)throw r}}return o.join("")}function feed_render_comment(e,t){return'\n        <li class="collection-item avatar comment_container" id="comment-'.concat(t,"-").concat(e.id,'">\n            <a href="/u/').concat(e.username,'" class="blue-text">\n                <img src="https://via.placeholder.com/25.jpg" data-src="').concat(e.profile_picture,'" onerror="this.src=\'https://cdn.lucacastelnuovo.nl/general/images/profile_picture.png\'" class="circle lazy" />\n                <span class="title tt-none">').concat(e.username,'</span>\n            </a>\n            <p class="truncate comment_body">').concat(e.body,"</p>\n            ").concat(e.user_is_owner?'<a href="#!" onclick="feed_delete_comment(\''.concat(t,"', '").concat(e.id,'\')" class="secondary-content tooltipped comment_delete_btn" data-position="right" data-tooltip="Delete comment"><i class="material-icons blue-icon">delete</i></a>'):"","\n        </li>\n    ")}function feed_render_messages(e){if(!e.success)return'\n            <li class="collection-item">\n                You don\'t have any messages.\n            </li>\n        ';delete e.CSRFtoken,localStorage.setItem("messages",JSON.stringify(e));var t=[],n=!0,o=!1,s=void 0;try{for(var a,r=e.messages[Symbol.iterator]();!(n=(a=r.next()).done);n=!0)message=a.value,t.push(feed_render_message(message))}catch(e){o=!0,s=e}finally{try{n||null==r.return||r.return()}finally{if(o)throw s}}new Sticky("#messages_box");return t.join("")}function feed_check_messages(){GETrequest("https://instakilo.lucacastelnuovo.nl/messages/actions",function(e){delete e.CSRFtoken,JSON.stringify(e)!==localStorage.getItem("messages")&&(M.Toast.dismissAll(),M.toast({html:'<span>You have new messages!</span><button class="btn-flat toast-action blue-text accent-4" onclick="location.reload()">Load messages</button>'}))})}function feed_render_message(e){return'\n        <li class="collection-item avatar">\n            <a href="/u/'.concat(e.username,'" class="blue-text">\n                <img src="').concat(e.profile_picture,'" onerror="this.src=\'https://cdn.lucacastelnuovo.nl/general/images/profile_picture.png\'" class="circle" />\n                <span class="title">').concat(e.username,'</span>\n            </a>\n            <p class="truncate">').concat(e.body,'</p>\n            <a href="/messages/#reply_to=').concat(e.username,'" class="secondary-content tooltipped" data-position="right" data-tooltip="Reply"><i class="material-icons blue-icon">reply</i></a>\n        </li>\n    ')}function user_followers(e){GETrequest("/u/".concat(e,"/followers"),function(e){var t=[],n=!0,o=!1,s=void 0;try{for(var a,r=e.followers[Symbol.iterator]();!(n=(a=r.next()).done);n=!0)user_owner_is_following=a.value,t.push('\n                <li class="collection-item avatar">\n                    <div class="row mb-0">\n                        <a href="/u/'.concat(user_owner_is_following.username,'" class="blue-text">\n                            <img\n                                src="').concat(user_owner_is_following.profile_picture,'"\n                                onerror="this.src=\'https://cdn.lucacastelnuovo.nl/general/images/profile_picture.png\'"\n                                class="circle"\n                            />\n                            <span class="title">').concat(user_owner_is_following.username,"</span>\n                        </a>\n                        ").concat(user_owner_is_following.is_user_self?'<a href="#" class="btn hidden">btn</a>':'<a onclick="'.concat(user_owner_is_following.is_following?"user_undo_follow('".concat(user_owner_is_following.username,"')"):"user_follow('".concat(user_owner_is_following.username,"')"),'" class="waves-effect btn right ').concat(user_owner_is_following.is_following?'grey lighten-5 black-text tooltipped" data-position="right" data-tooltip="Unfollow':'waves-light blue accent-4 "','">').concat(user_owner_is_following.is_following?"Following":"Follow","\n                            </a>"),"\n                    </div>\n                </li>\n            "))}catch(e){o=!0,s=e}finally{try{n||null==r.return||r.return()}finally{if(o)throw s}}document.querySelector("#followers_container").innerHTML=t.join("");M.Tooltip.init(document.querySelectorAll(".tooltipped"),{});M.Modal.getInstance(document.querySelector("#followers_modal")).open(),document.querySelector("#followersNumber").innerHTML=e.followers_number})}function user_following(e){GETrequest("/u/".concat(e,"/following"),function(e){var t=[],n=!0,o=!1,s=void 0;try{for(var a,r=e.following[Symbol.iterator]();!(n=(a=r.next()).done);n=!0)user_owner_is_following=a.value,t.push('\n                <li class="collection-item avatar">\n                    <div class="row mb-0">\n                        <a href="/u/'.concat(user_owner_is_following.username,'" class="blue-text">\n                            <img\n                                src="').concat(user_owner_is_following.profile_picture,'"\n                                onerror="this.src=\'https://cdn.lucacastelnuovo.nl/general/images/profile_picture.png\'"\n                                class="circle"\n                            />\n                            <span class="title">').concat(user_owner_is_following.username,"</span>\n                        </a>\n                        ").concat(user_owner_is_following.is_user_self?'<a href="#" class="btn hidden">btn</a>':'<a onclick="'.concat(user_owner_is_following.is_following?"user_undo_follow('".concat(user_owner_is_following.username,"')"):"user_follow('".concat(user_owner_is_following.username,"')"),'" class="waves-effect btn right ').concat(user_owner_is_following.is_following?'grey lighten-5 black-text tooltipped" data-position="right" data-tooltip="Unfollow':'waves-light blue accent-4 "','">').concat(user_owner_is_following.is_following?"Following":"Follow","\n                            </a>"),"\n                    </div>\n                </li>\n            "))}catch(e){o=!0,s=e}finally{try{n||null==r.return||r.return()}finally{if(o)throw s}}document.querySelector("#following_container").innerHTML=t.join("");M.Tooltip.init(document.querySelectorAll(".tooltipped"),{});M.Modal.getInstance(document.querySelector("#following_modal")).open(),document.querySelector("#followingNumber").innerHTML=e.following_number})}function user_follow(e){GETrequest("/u/".concat(e,"/follow/").concat(CSRFtoken),function(){M.Toast.dismissAll(),M.toast({html:"".concat(e," followed")}),location.reload()})}function user_undo_follow(e){GETrequest("/u/".concat(e,"/undo_follow/").concat(CSRFtoken),function(){M.Toast.dismissAll(),M.toast({html:"".concat(e," unfollowed")}),location.reload()})}function render_hashtags(){var e=document.querySelectorAll(".post_caption"),t=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(t=(s=a.next()).done);t=!0)caption=s.value,caption.innerHTML=caption.innerHTML.replace(/(^|\s)(#[a-z\d-]+)/gi,"$1<span class='hash_tag'>$2</span>")}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}var r=document.querySelectorAll(".comment_body"),l=!0,i=!1,c=void 0;try{for(var u,d=r[Symbol.iterator]();!(l=(u=d.next()).done);l=!0)comment=u.value,comment.innerHTML=comment.innerHTML.replace(/(^|\s)(#[a-z\d-]+)/gi,"$1<span class='hash_tag'>$2</span>")}catch(e){i=!0,c=e}finally{try{l||null==d.return||d.return()}finally{if(i)throw c}}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}document.addEventListener("DOMContentLoaded",function(){yall({observeChanges:!0,idlyLoad:!0}),"undefined"!=typeof auto_init&&auto_init||materialize_init()}),window.yall=function(e){var t=function(e){if("IMG"===e.tagName){var t=e.parentNode;"PICTURE"===t.tagName&&[].slice.call(t.querySelectorAll("source")).forEach(function(e){return n(e)}),n(e)}"VIDEO"===e.tagName&&([].slice.call(e.querySelectorAll("source")).forEach(function(e){return n(e)}),n(e),!0===e.autoplay&&e.load()),"IFRAME"===e.tagName&&(e.src=e.dataset.src,e.removeAttribute("data-src")),e.classList.contains(a.lazyBackgroundClass)&&(e.classList.remove(a.lazyBackgroundClass),e.classList.add(a.lazyBackgroundLoaded))},n=function(e){for(var t in e.dataset)-1!==s.acceptedDataAttributes.indexOf("data-"+t)&&(e.setAttribute(t,e.dataset[t]),e.removeAttribute("data-"+t))},o=function e(){var n=!1;!1===n&&0<i.length&&(n=!0,setTimeout(function(){i.forEach(function(e){e.getBoundingClientRect().top<=window.innerHeight+a.threshold&&e.getBoundingClientRect().bottom>=-a.threshold&&"none"!==getComputedStyle(e).display&&(!0===a.idlyLoad&&!0===s.idleCallbackSupport?requestIdleCallback(function(){t(e)},l):t(e),e.classList.remove(a.lazyClass),i=i.filter(function(t){return t!==e}))}),n=!1,0===i.length&&!1===a.observeChanges&&s.eventsToBind.forEach(function(t){return t[0].removeEventListener(t[1],e)})},a.throttleTime))},s={intersectionObserverSupport:"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype,mutationObserverSupport:"MutationObserver"in window,idleCallbackSupport:"requestIdleCallback"in window,ignoredImgAttributes:["data-src","data-sizes","data-media","data-srcset","src","srcset"],acceptedDataAttributes:["data-src","data-sizes","data-media","data-srcset","data-poster"],eventsToBind:[[document,"scroll"],[document,"touchmove"],[window,"resize"],[window,"orientationchange"]]},a=_extends({lazyClass:"lazy",lazyBackgroundClass:"lazy-bg",lazyBackgroundLoaded:"lazy-bg-loaded",throttleTime:200,idlyLoad:!1,idleLoadTimeout:100,threshold:200,observeChanges:!1,observeRootSelector:"body",mutationObserverOptions:{childList:!0}},e),r="img."+a.lazyClass+",video."+a.lazyClass+",iframe."+a.lazyClass+",."+a.lazyBackgroundClass,l={timeout:a.idleLoadTimeout},i=[].slice.call(document.querySelectorAll(r));if(!0===s.intersectionObserverSupport){var c=new IntersectionObserver(function(e,n){e.forEach(function(e){if(!0===e.isIntersecting||0<e.intersectionRatio){var o=e.target;!0===a.idlyLoad&&!0===s.idleCallbackSupport?requestIdleCallback(function(){return t(o)},l):t(o),o.classList.remove(a.lazyClass),n.unobserve(o),i=i.filter(function(e){return e!==o})}})},{rootMargin:a.threshold+"px 0%"});i.forEach(function(e){return c.observe(e)})}else s.eventsToBind.forEach(function(e){return e[0].addEventListener(e[1],o)}),o();!0===s.mutationObserverSupport&&!0===a.observeChanges&&new MutationObserver(function(e){return e.forEach(function(){[].slice.call(document.querySelectorAll(r)).forEach(function(e){-1===i.indexOf(e)&&(i.push(e),!0===s.intersectionObserverSupport?c.observe(e):o())})})}).observe(document.querySelector(a.observeRootSelector),a.mutationObserverOptions)};
//# sourceMappingURL=app.js.map